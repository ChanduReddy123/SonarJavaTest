def firetv = "OK"
def flagship = "OK"
def modules = "NOK" 
def sharedui ="NOK"
pipeline{
    agent{
        label "master"
    }
    stages{
        stage("Building myapp0"){
            steps{
                sh '''
                cd myapp
                mvn clean package
                '''
            }
        }
        stage("Building myapp1"){
            steps{
                sh '''
                cd myapp1
                mvn clean package
                '''
              }
        }
        stage("Scanning myapp0"){
            steps{
                withSonarQubeEnv('sonar-1') {
                    sh """
                    
                    """
                    script{
                        sonar-scanner -Dproject.settings=myapp/sonar-project.properties
                        timeout(time: 1, unit: 'HOURS') {
                            def response = waitForQualityGate()
                            modules=response.status
                        }
                    }
                }
            }
        }
        stage("Scanning myapp1"){
            steps{
                withSonarQubeEnv('sonar-1') {
                    sh """
                    sonar-scanner -Dproject.settings=myapp1/sonar-project.properties
                    """
                    script{
                        timeout(time: 1, unit: 'HOURS') {
                            def response = waitForQualityGate()
                            sharedui=response.status
                        }
                    }
                }
            }
        }
        stage("status code"){
            steps{
                script{
                    print("--------")
                    print(modules)
                    print(sharedui)
                    print("--------")
                }
            }
        }
        stage("Conditonal Check firetv"){
            when{
                allOf{
                    expression{modules == "OK"}
                    expression{sharedui == "OK"}
                    expression{firetv == "OK"}
                }
            }
            steps{
                echo "FireTV is successfull"
            }
            
        }
        stage("Conditonal Check flagship"){
            when{
                allOf{
                    expression{modules == "OK"}
                    expression{sharedui == "OK"}
                    expression{flagship == "OK"}
                }
            }
            steps{
                echo "Flagship is successful"
            }
            
        }
    }
    
}