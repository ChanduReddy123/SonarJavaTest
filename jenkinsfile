def firetv = "NOK"
def flagship = "OK"
def modules = "OK"
def sharedui ="OK"
pipeline{
    agent{
        label "master"
    }
    stages{
        stage("myapp0"){
            steps{
               withSonarQubeEnv('sonar-1') {
                sh '''
                cd myapp
                mvn clean package sonar:sonar \
                    -Dsonar.projectKey=myapp0 \
                    -Dsonar.host.url=http://18.235.234.59:9000 \
                    -Dsonar.login=1fd6361916254a03a909528a6e825d9516915ae6
                '''
              }
              script{
                   timeout(time: 1, unit: 'HOURS') {
                   def response = waitForQualityGate()
                   myapp0=response.status
              }
              }
            }
        }
        stage("myapp1"){
            steps{
               withSonarQubeEnv('sonar-1') {
                sh '''
                cd myapp1
                mvn clean package sonar:sonar \
                    -Dsonar.projectKey=myapp1 \
                    -Dsonar.host.url=http://18.235.234.59:9000 \
                    -Dsonar.login=1fd6361916254a03a909528a6e825d9516915ae6
                '''
              }
              script{
                   timeout(time: 1, unit: 'HOURS') {
                   def response = waitForQualityGate()
                   myapp1=response.status
              }
              }
            }
        }
        stage("status code"){
            steps{
                script{
                    print("--------")
                    print(myapp0)
                    print(myapp1)
                    print("--------")
                }
            }
        }
        stage("Conditonal Check firetv"){
            when{
                allOf{
                    expression{modules == "OK"}
                    expression{modules == "OK"}
                    expression{firetv == "OK"}
                }
            }
            steps{
                echo "FireTV is successfull"
            }
            
        }
        stage("Conditonal Check flagship"){
            when{
                allOf{
                    expression{modules == "OK"}
                    expression{sharedui == "OK"}
                    expression{flagship == "OK"}
                }
            }
            steps{
                echo "Flagship is successful"
            }
            
        }
    }
    
}